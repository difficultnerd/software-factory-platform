name = "sfp-api"
main = "src/index.ts"
compatibility_date = "2025-01-01"
compatibility_flags = ["nodejs_compat"]

# Production overrides set via:
# wrangler secret put SUPABASE_URL
# wrangler secret put SUPABASE_ANON_KEY
# wrangler secret put SUPABASE_SERVICE_ROLE_KEY
# wrangler secret put ALLOWED_ORIGIN

[[r2_buckets]]
binding = "ARTIFACTS"
bucket_name = "buildpractical-artifacts"

# Pipeline queue â€” agents run as queue consumers (15 min execution limit)
[[queues.producers]]
queue = "pipeline-queue"
binding = "PIPELINE_QUEUE"

[[queues.consumers]]
queue = "pipeline-queue"
max_batch_size = 1
max_retries = 2
dead_letter_queue = "pipeline-dlq"

# Stuck-task recovery: runs every 15 minutes
[triggers]
crons = ["*/15 * * * *"]
